<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    	<style>
		a{text-decoration:none}
		a:hover{color:blue,text-decoration:none}
		a:visited{color:black,text-decoration:none}
		a:link{color:black,text-decoration:none}
		a:active{color:black,text-decoration:none}
	</style>
</head>
<body>
Python Libs Dependency Graph<br>
<a href="/">Python3.6</a>|<a href="/network?wanted={{jfile}}">network</a>|<a href="/tree?wanted={{jfile}}">filetree</a>|<a href="/leetree?wanted={{jfile}}">bitree</a>|<a href="/hicircle?wanted={{jfile}}">cluster</a>|<a href="/matrix?wanted={{jfile}}">matrix</a>|<a href="/bubble?wanted={{jfile}}">bubble</a>|
<a href="/wordcloud?wanted={{jfile}}">wordcloud</a>|
<script src="static/d3.v7.min.js"></script>
    <script>
    //删除空格
            var nodeweight;
            var nodecount=0;
            var edgecount=0;
            function trim(str){
                return str.replace(/\s|\xA0/g,"");
            }
		    var width=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)*0.98;
		    var height=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)*1.5;
			var color = d3.scaleOrdinal(d3.schemeCategory10);

<!--			var  = d3.forceManyBody()-->
<!--				.strength(-600); //电荷力-->

			var svg = d3.select("body").append("svg")
				.attr("width", width)
				.attr("height", height);

			svg.append("rect")
				   .attr("x",1)
				   .attr("y",1)
				   .attr("width",width-2)
				   .attr("height",height-2)
				   .attr("stroke","#777")
				   .attr("fill","#FFF");
			//提示框部分
            var tooltip=d3.selectAll("body")
                        .append("div")
                        .attr("class","tooltip")
                        .style("opacity",0.5);
			//d3.json("static/netjson/networkx.json", function(error, graph) {
			//console.log(width,height);

			d3.json("static/netjson/{{jsonfile}}").then(function(graph) {
			      console.log(graph);
				  var nodes=graph.nodes;
				  var links=graph.links;
				  console.log(nodes.length);
				  console.log(links.length);
				  nodecount=nodes.length;
				  edgecount=links.length;
				  nodeweight=new Array(nodes.length);
				  var ncount=nodes.length;
                  var R=height/nodes.length*0.3;
                  if(nodes.length<40) R=10;

                  var bgrecdata=new Array(ncount*ncount);
                  var bgrec=svg.selectAll('rect')
                            .data(bgrecdata)
                            .enter()
                            .append("rect")
                            .attr("x",(d,i)=>(400+R+(2*R)*(i%ncount)))
                            .attr("y",(d,i)=>(3*R+(2*R)*Math.floor(i/ncount)))
                            .attr("width",2*R-1)
                            .attr("height",2*R-1)
                            .attr("fill","lightgray");

				  var simulation = d3.forceSimulation(nodes)
                                .force('charge', d3.forceManyBody().strength(-600))
                                .force('link', d3.forceLink(links));



<!--					   .links(links)-->
<!--					   .linkDistance(300*Math.random())-->
<!--					   .start();-->
                  var textlist=svg.selectAll(".textList")
                             .data(nodes)
                             .enter()
                             .append("text")
                             .attr("class","textList")
                             .style("font-family","Times New Roman")
                             .style("font-size",""+R*2+"px")
                             .attr("font-weight","bold")
                             .attr("text-anchor","right")
                             .attr("x",function(d,i){
                                //console.log(d,i);
                                var tt=trim(d.name);//去字符串首尾空格
                                //return 360-d.name.length*R;
                                return 5;
                             })
                             .attr("y",function(d,i){return R*5+i*R*2})
                             .text(function(d){return d.name;})
                             .on("mouseover",function(d,i){
                                d3.select(this)
                                  .style("fill","#F00")
				                  .style("font-size","20px");
                                nodeLeft.filter(function(t) { 	//过滤器
				                     //console.log(t.index,"zuo+",i,d);
                                     return t.index== i.index;
                                })
                                .attr("r",R*1.5);
                                node.filter(function(t) { 	//过滤器
                                     //console.log("shang+");
                                     return t.index== i.index;
                                })
                                .attr("r",R*1.5);
                             })
                             .on("mouseout",function(d,i){
                                d3.select(this)
                                  .style("fill","#000")
                                  .style("font-size",""+R*2+"px");
                                nodeLeft.filter(function(t) { 	//过滤器
                                     return t.index== i.index;
                                })
                                .attr("r",R);
                                node.filter(function(t) { 	//过滤器
                                     return t.index== i.index;
                                })
                                .attr("r",R);
                             })
                             .on("mousedown",function(d,i){
                                textlist.filter(function(t) { 	//过滤器
                                        //console.log(t.index,i)
                                         return t.index != i.index;
                                    })
                                    .style("fill","#000")
                                    .style("font-size",""+R*2+"px");
                                link.filter( function(l) { 	//过滤器
				                     textlist.filter(function(t) { 	//过滤器
                                            return (t.index==l.target.index)&&(l.source.index == i.index);
                                     })
                                     .style("fill","rgb(255, 127, 14)")
                                     .style("font-size",""+R*2+"px");
                                     return l.source.index == i.index;//以当前text做头
                                })
				                .style("fill","rgb(255,127,14)")   //橙色（依赖其他的.py模块）
				                .style("stroke-width",1);
				                link.filter( function(l) { 	//过滤器
				                     textlist.filter(function(t) { 	//过滤器
                                            return (t.index==l.source.index)&&(l.target.index == i.index);
                                     })
                                     .style("fill","rgb(44,160,44)")
                                     .style("font-size",""+R*2+"px");
                                     return l.target.index == i.index;//以当前text做尾
                                })
				                .style("fill","rgb(44,160,44)")   //绿色（被其他.py模块依赖）
				                .style("stroke-width",1);

                                link.filter( function(l) { 	//过滤器
                                         return l.source.index != i.index && l.target.index != i.index;
                                    })
                                    .style("fill","FFFFFF")
                                    .style("stroke-width",1);

                                textlist.filter( function(t) { 	//过滤器
                                         return t.index == i.index;
                                    })
                                    .style("fill","#F00")
                                    .style("font-size","18px");
				            });

			      var link = svg.selectAll(".link")
					  .data(links)
					  .enter().append("rect")
					  .attr("class", "link")
					  .attr("x",function(d,i){
					        //console.log(d,i)
					        return 400+R+d.source.index*R*2})
					  .attr("y",function(d,i){return 3*R+d.target.index*R*2})
					  .attr("width",R*2-1)
					  .attr("height",R*2-1)
					  .attr("fill","rgb(255,127,14)")
					  .style("stroke-width", function(d) { return Math.sqrt(d.value); })
					  .on("mouseover",function(d,i){
                                d3.select(this)
                                  .style("fill","#F00");

                                nodeLeft.filter(function(t) { 	//过滤器
                                     //console.log(d,i,t)
                                     return t.index== i.target.index;
                                })
                                .attr("r",R*1.5);
                                node.filter(function(t) { 	//过滤器
                                     //console.log("111",d.source.index);
                                     return t.index == i.source.index;
                                })
                                .attr("r",R*1.5);

				                textlist.filter( function(t) { 	//过滤器
<!--				                    tooltip.html(d.source.name)-->
<!--                                           .style("left",(d3.event.pageX-45)+"px")-->
<!--                                           .style("top",(d3.event.pageY+20)+"px")-->
<!--                                           .style("opacity",1);//完全透明-->
                                    return t.index == i.target.index;
                                })
				                .style("fill","#F00")
				                .style("font-size","18px");
				      })
				      .on("mouseout",function(d,i){
                                d3.select(this)
                                  .style("fill","lightgray");
                                nodeLeft.filter(function(t) { 	//过滤器
                                     return t.index== i.target.index;
                                })
                                .attr("r",R);
                                node.filter(function(t) { 	//过滤器
                                     return t.index== i.source.index;
                                })
                                .attr("r",R);

                                textlist.filter(function(t) { 	//过滤器
                                    tooltip.style("opacity",0);
                                    return t.index == i.target.index;
                                })
				                .style("fill","#000")
				                .style("font-size",""+R*2+"px");
				      });
				  var node = svg.selectAll(".node")
					  .data(nodes)
					  .enter().append("circle")
					  .attr("class", "node")
					  .attr("r", R)
					  .attr("cx",function(d,i){return 400+R*2+R*2*i})
					  .attr("cy",R*2)
					  .style("fill", function(d,i) {return color(i); })
					  .attr("stroke","black")
					  .on("mouseover",function(d,i){    //加入提示框
<!--                            tooltip.html(d.name)-->
<!--                                   .style("left",(d3.event.pageX)+"px")-->
<!--                                   .style("top",(d3.event.pageY+20)+"px")-->
<!--                                   .style("opacity",0.7);-->
                            d3.select(this)
                             .attr("r",R*1.5);
                            nodeLeft.filter(function(t) { 	//过滤器
                                     return t.index== i.index;
                                })
                               .attr("r",R*1.5);

				            textlist.filter( function(m) { 	//过滤器
                                     return m.index == i.index;
                                })
				                .style("fill","#F00")
				                .style("font-size","18px")
				                .attr("dx",80);
					  })
					  .on("mouseout",function(d,i){
					        tooltip.style("opacity",0.0);
					        d3.select(this)
                              .attr("r",R);
                            nodeLeft.filter(function(t) { 	//过滤器
                                     return t.index== i.index;
                                })
                               .attr("r",R);

                            textlist.filter(function(m) { 	//过滤器
                                     return m.index == i.index;
                                })
				                .style("fill","#000")
				                .style("font-size",""+R*2+"px")
				                .attr("dx",0);
				      })
				      .on("mousedown",function(d,i){
				            textlist.filter( function(t) { 	//过滤器
                                    return(t.index!=i.index)
                                })
				                .style("fill","#000")
				                .attr("dx",0);
				            link.filter( function(l) { 	//过滤器
				                     textlist.filter(function(t) { 	//过滤器
                                            return (t.index==l.target.index)&&(l.source.index == i.index);
                                     })
                                     .style("fill","rgb(255, 127, 14)") //当前节点为头变橙色
                                     .style("font-size",""+R*2+"px")
                                     .attr("dx",20);
                                     return l.source.index == i.index;
                                })
				                .style("fill","#F00")   //橙色rgb(255,127,14)（依赖其他的.py模块）
				                .style("stroke-width",1);
				            link.filter( function(l) { 	//过滤器
				                     textlist.filter(function(t) { 	//过滤器
                                            return (t.index==l.source.index)&&(l.target.index == i.index);
                                     })
                                     .style("fill","rgb(44,160,44)")
                                     .style("font-size",""+R*2+"px")
                                     .attr("dx",20);
                                     return l.target.index == i.index;
                                })
				                .style("fill","rgb(44,160,44)")   //绿色（被其他.py模块依赖）
				                .style("stroke-width",1);
                            link.filter( function(l) { 	//过滤器
                                     return l.source.index != i.index && l.target.index != i.index;
                                })
				                .style("fill","lightgray")
				                .style("stroke-width",1);
				            textlist.filter( function(t) { 	//过滤器
                                    return(t.index==i.index)
                                })
				                .style("fill","#F00")
				                .style("font-size","18px");
				      });
					  //.call(force.drag);
				  var nodeLeft = svg.selectAll(".nodeLeft")
					  .data(nodes)
					  .enter().append("circle")
					  .attr("class", "nodeLeft")
					  .attr("r", R)
					  .attr("cy",function(d,i){return R*4+R*2*i})
					  .attr("cx",400)
					  .style("fill", function(d,i) {return color(i); })
					  .attr("stroke","black")
					  .on("mouseover",function(d,i){    //加入提示框
<!--                            tooltip.html(d.name)-->
<!--                                   .style("left",(d3.event.pageX)+"px")-->
<!--                                   .style("top",(d3.event.pageY+20)+"px")-->
<!--                                   .style("opacity",0.7);-->
                            d3.select(this)
                             .attr("r",R*1.5)
                             .attr("fill","none");
                            node.filter(function(t) { 	//过滤器
                                     return t.index== i.index;
                                })
                              .attr("r",R*1.5);
                            textlist.filter( function(m) { 	//过滤器
                                     return m.index == i.index;
                                })
				                .style("fill","#F00")
				                .style("font-size","18px");
					  })
					  .on("mouseout",function(d,i){
					        tooltip.style("opacity",0.0);
					        d3.select(this)
                              .attr("r",R);
                            node.filter(function(t) { 	//过滤器
                                     return t.index== i.index;
                                })
                               .attr("r",R);
                            textlist.filter(function(m) { 	//过滤器
                                     return m.index == i.index;
                                })
				                .style("fill","#000")
				                .style("font-size",""+R*2+"px");
				      })
				      .on("mousedown",function(d,i){

				            link.filter( function(l) { 	//过滤器
                                     return l.source.index == i.index;
                                })
				                .style("fill","rgb(255,127,14)")   //橙色（依赖其他的.py模块）
				                .style("stroke-width",1);
				            link.filter( function(l) { 	//过滤器
                                     return l.target.index == i.index;
                                })
				                .style("fill","rgb(44,160,44)")   //绿色（被其他.py模块依赖）
				                .style("stroke-width",1);
                            link.filter( function(l) { 	//过滤器
                                     return l.source.index != i.index && l.target.index != i.index;
                                })
				                .style("fill","FFFFFF")//为什么不是heightgray
				                .style("stroke-width",1);
				            textlist.filter(function(t) { 	//过滤器
                                     return t.index != i.index;
                                })
				                .style("fill","#000")
				                .style("font-size",R*2)
				                .attr("x",5);
				            textlist.filter( function(t) { 	//过滤器
                                     return t.index == i.index;
                                })
				                .style("fill","#F00")
				                .style("font-size","18px");
				      });
					  //.call(force.drag);

					  function sourceNode(){
                          textlist.filter(function(t) { 	//过滤器
                                    for(var k=0;k<links.length;k++){
                                        return (links[k].source.index==t.index)
                                    }
                                })
                                .style("fill","rgb(44,160,44)")
                                .style("font-size",""+R*2+"px");
                      }
                      function targetNode(){
                          textlist.filter(function(t) { 	//过滤器
                                        for(var k=0;k<links.length;k++){
                                            return (links[k].target.index==t.index)
                                        }
                                    })
                                    .style("fill","rgb(44,160,44)")
                                    .style("font-size",""+R*2+"px");
                      }
				});
	</script>
</body>
</html>